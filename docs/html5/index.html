<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<title>GQL</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>GQL</h1>
<div class="details">
<span id="revnumber">version 0.3.0</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_intro">1. Intro</a></li>
<li><a href="#_getting_started">2. Getting started</a>
<ul class="sectlevel2">
<li><a href="#_hello_gql">2.1. Hello GQL</a></li>
<li><a href="#_gradle">2.2. Gradle</a></li>
</ul>
</li>
<li><a href="#_dsl">3. DSL</a>
<ul class="sectlevel2">
<li><a href="#_types">3.1. Types</a>
<ul class="sectlevel3">
<li><a href="#_full_types">3.1.1. Full types</a></li>
<li><a href="#_shorter_field_definition">3.1.2. Shorter field definition</a></li>
<li><a href="#_adding_external_fields">3.1.3. Adding external fields</a></li>
</ul>
</li>
<li><a href="#_scalars">3.2. Scalars</a>
<ul class="sectlevel3">
<li><a href="#_declaration">3.2.1. Declaration</a></li>
<li><a href="#_deserialization">3.2.2. Deserialization</a></li>
<li><a href="#_serialization">3.2.3. Serialization</a></li>
</ul>
</li>
<li><a href="#_enums">3.3. Enums</a></li>
<li><a href="#_schemas">3.4. Schemas</a>
<ul class="sectlevel3">
<li><a href="#_static_values">3.4.1. Static values</a></li>
<li><a href="#_fetchers">3.4.2. Fetchers</a></li>
<li><a href="#_good_practices">3.4.3. Good practices</a></li>
</ul>
</li>
<li><a href="#_modularising">3.5. Modularising</a>
<ul class="sectlevel3">
<li><a href="#_custom_scalar_implementation">3.5.1. Custom Scalar implementation</a></li>
</ul>
</li>
<li><a href="#_inputs">3.6. Inputs</a>
<ul class="sectlevel3">
<li><a href="#_arguments">3.6.1. Arguments</a></li>
</ul>
</li>
<li><a href="#_queries">3.7. Queries</a>
<ul class="sectlevel3">
<li><a href="#_execution">3.7.1. Execution</a></li>
<li><a href="#_asynchronous_execution">3.7.2. Asynchronous Execution</a></li>
<li><a href="#_query_builders">3.7.3. Query builders</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_relay">4. Relay</a>
<ul class="sectlevel2">
<li><a href="#_what_is_relay">4.1. What is Relay ?</a></li>
<li><a href="#_what_gql_implements">4.2. What GQL implements ?</a></li>
<li><a href="#_node">4.3. Node</a>
<ul class="sectlevel3">
<li><a href="#_listfetcher">4.3.1. listFetcher</a></li>
</ul>
</li>
<li><a href="#_connection">4.4. Connection</a></li>
<li><a href="#_full_example">4.5. Full Example</a></li>
</ul>
</li>
<li><a href="#_ratpack">5. Ratpack</a>
<ul class="sectlevel2">
<li><a href="#_example">5.1. Example</a></li>
<li><a href="#_execution_context">5.2. Execution context</a></li>
<li><a href="#_graphql_errors">5.3. GraphQL errors</a></li>
<li><a href="#_instrumentation">5.4. Instrumentation</a></li>
<li><a href="#_configuration">5.5. Configuration</a></li>
</ul>
</li>
<li><a href="#_development">6. Development</a>
<ul class="sectlevel2">
<li><a href="#_source_code">6.1. Source code</a></li>
<li><a href="#_groovydoc">6.2. Groovydoc</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
GQL is a library created to make it easier to expose and consume
GraphQL services.
</blockquote>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Apache</div>
<div class="paragraph">
<p>The <strong>GQL</strong> project is open sourced under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache 2 License</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_intro">1. Intro</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>GQL</strong> is a set of Groovy DSLs and AST transformations built on top of
<a href="https://github.com/graphql-java/graphql-java">GraphQL-java</a> to make it easier building GraphQL schemas and
execute <strong>GraphQL</strong> queries without losing type safety.</p>
</div>
<div class="paragraph">
<p><strong>GraphQL</strong> is a query language. It&#8217;s based in a type system and defines a specific query language
and how a specific query engine should work in order to process and execute GraphQL queries.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
For a full detailed explanation about GraphQL I would recommend you to take
a look at the official tutorial at <a href="http://graphql.org/learn/" class="bare">http://graphql.org/learn/</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Keeping long story short When dealing with <strong>GraphQL</strong> you normally will be following the these steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Define the schema</strong> (first types, scalars&#8230;&#8203;and then adding those types to schema roots)</p>
</li>
<li>
<p><strong>Expose the schema</strong> (via the chosen GraphQL implementation engine)</p>
</li>
<li>
<p><strong>Execute queries</strong> against the implementation engine</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/diag-d33e7655e9006340df72dc8dc141695b.png" alt="diag d33e7655e9006340df72dc8dc141695b" width="780" height="126">
</div>
</div>
<div class="paragraph">
<p>Some of the ideas behind <strong>GQL</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It should be <strong>IDE friendly</strong></p>
</li>
<li>
<p>It should be built having <strong>static compilation</strong> in mind</p>
</li>
<li>
<p>It should <strong>not need more than one import</strong></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">2. Getting started</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_hello_gql">2.1. Hello GQL</h3>
<div class="paragraph">
<p>This is how a full GraphQL life cycle app looks like using <strong>GQL</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Grab</span>(<span class="string"><span class="delimiter">'</span><span class="content">com.github.grooviter:gql-core:0.2.0</span><span class="delimiter">'</span></span>)
<span class="keyword">import</span> <span class="include">gql.DSL</span>

<span class="keyword">def</span> GraphQLFilm = DSL.type(<span class="string"><span class="delimiter">'</span><span class="content">Film</span><span class="delimiter">'</span></span>) { <i class="conum" data-value="1"></i><b>(1)</b>
  field <span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>, GraphQLString
  field <span class="string"><span class="delimiter">'</span><span class="content">year</span><span class="delimiter">'</span></span>, GraphQLInt
}

<span class="keyword">def</span> schema = DSL.schema { <i class="conum" data-value="2"></i><b>(2)</b>
  queries {
    field(<span class="string"><span class="delimiter">'</span><span class="content">lastFilm</span><span class="delimiter">'</span></span>) {
      type GraphQLFilm
      staticValue(<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">SPECTRE</span><span class="delimiter">'</span></span>, <span class="key">year</span>: <span class="integer">2015</span>)
    }
  }
}

<span class="keyword">def</span> query = <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
  {
    lastFilm {
      year
      title
    }
  }
</span><span class="delimiter">&quot;&quot;&quot;</span></span>

<span class="keyword">def</span> result = DSL.execute(schema, query) <i class="conum" data-value="3"></i><b>(3)</b>

<span class="keyword">assert</span> result.data.lastFilm.year == <span class="integer">2015</span>
<span class="keyword">assert</span> result.data.lastFilm.title == <span class="string"><span class="delimiter">'</span><span class="content">SPECTRE</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creates a type <code>GraphQLFilm</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Creates a <code>GraphQL schema</code> using the previously defined types</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Executes a <code>GraphQL query string</code> against the schema</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can execute the example as a Groovy script in the command line or using
the <a href="http://www.groovy-lang.org/groovyconsole.html">Groovy console</a> both available in
any Groovy distribution.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We have executed the query as a query string, however there is
a safer way of building queries using the <code>DSL.query()`</code> builder. It gives you some sanity checks based on the types
used.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_gradle">2.2. Gradle</h3>
<div class="paragraph">
<p>You can add the following dependency to your Gradle project</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gradle">compile 'com.github.grooviter:gql-core:0.3.0'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The library is available at Bintray so all you have to do is
to include the <code>jcenter()</code> declaration in your dependency repositories
in your Gradle script.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
   jcenter()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dsl">3. DSL</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_types">3.1. Types</h3>
<div class="paragraph">
<p>Types define the structure of the data you want to expose. There two main sets of types, scalars and custom types. The
former are specified by the GraphQL specification and are basic types such as strings, integers&#8230;&#8203;etc whereas the latter
refer to the types the developer will be defining (a Book, a Car&#8230;&#8203;etc). We&#8217;ll make use of the scalars to build our
own types.</p>
</div>
<div class="sect3">
<h4 id="_full_types">3.1.1. Full types</h4>
<div class="paragraph">
<p>In order to define a full type using <strong>GQL</strong> the only thing you have to do is to import <strong>gql.DSL</strong> and use the method
<code>type</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">gql.DSL</span>

<span class="keyword">def</span> type = DSL.type(<span class="string"><span class="delimiter">'</span><span class="content">Droid</span><span class="delimiter">'</span></span>) { <i class="conum" data-value="1"></i><b>(1)</b>
  description<span class="string"><span class="delimiter">'</span><span class="content">simple droid</span><span class="delimiter">'</span></span> <i class="conum" data-value="2"></i><b>(2)</b>

  field(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) { <i class="conum" data-value="3"></i><b>(3)</b>
    description<span class="string"><span class="delimiter">'</span><span class="content">name of the droid</span><span class="delimiter">'</span></span>
    type GraphQLString
  }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines a new type called <code>Film</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Adds a type description (useful to client users when exposing the schema)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Adds a field of type string (GraphQLString)</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The resulting <code>type</code> variable is an instance of <code>graphql.schema.GraphQLObjectType</code>.
We haven&#8217;t added the specific type to highlight the fact that no other import is needed. All basic scalar types such
as <code>GraphQLString</code> are defined within the DSL and both the compiler and the IDE should be able to recognize them.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can add as many <code>field('fieldName') { }</code> blocks to your type as you want.</p>
</div>
</div>
<div class="sect3">
<h4 id="_shorter_field_definition">3.1.2. Shorter field definition</h4>
<div class="paragraph">
<p>There is a shorter way of defining a given type. It&#8217;s specially useful when you&#8217;re prototyping or when you don&#8217;t care
about adding descriptions to your types. You can use the method <code>field(String, Scalar)</code> method within the <code>type</code> DSL.
The following example adds three different fields to the <code>Droid</code> type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">gql.DSL</span>
<span class="keyword">import</span> <span class="include">graphql.schema.GraphQLObjectType</span>

GraphQLObjectType type = DSL.type(<span class="string"><span class="delimiter">'</span><span class="content">Droid</span><span class="delimiter">'</span></span>) {
  field <span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, GraphQLString
  field <span class="string"><span class="delimiter">'</span><span class="content">type</span><span class="delimiter">'</span></span>, GraphQLString
  field <span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>, GraphQLInt
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_adding_external_fields">3.1.3. Adding external fields</h4>
<div class="paragraph">
<p>Sometimes you may want to keep type and field definitions apart, maybe to reuse those definitions, or maybe because it
gives you more flexibility when structuring your app.</p>
</div>
<div class="paragraph">
<p>In the following example a field called name. It will always return its value in uppercase.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">gql.DSL</span>

<span class="keyword">def</span> nameToUpperCaseField = DSL.field(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) {
  type GraphQLString
  fetcher { DataFetchingEnvironment env -&gt;
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>env.source.name<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>.toUpperCase()
  }
}</code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Static compilation</div>
<div class="paragraph">
<p>If you would like to use static compilation here, I think is important to bear in mind <strong>getSource()</strong> signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;T&gt; T getSource()</code></pre>
</div>
</div>
<div class="paragraph">
<p>This signature means that the result of executing <strong>getSource()</strong> will be casted to the element type found on
the left hand side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">gql.DSL</span>

<span class="keyword">def</span> ageMinusOne = DSL.field(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>) {
  type GraphQLInt
  fetcher { DataFetchingEnvironment env -&gt;
    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; data = env.getSource() <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="keyword">return</span> data.age - <span class="integer">1</span> <i class="conum" data-value="2"></i><b>(2)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><strong>DataFetchingEnvironment#getSource()</strong> casts its result to the left side element
type (Map&lt;String,Integer&gt; in this case)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Then the compiler is ok with substracting 1 from an integer</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>Then we can use this definition in any type we want usign the <code>addField</code> method inside <code>type</code> DSL. In the example
every person&#8217;s name will be returned in uppercase.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">gql.DSL</span>

<span class="keyword">def</span> people = DSL.type(<span class="string"><span class="delimiter">'</span><span class="content">People</span><span class="delimiter">'</span></span>) {
  addField nameToUpperCaseField
  addField ageMinusOne
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scalars">3.2. Scalars</h3>
<div class="paragraph">
<p><strong>GraphQL</strong> scalars represent the basic data types, such integers, strings, floats&#8230;&#8203;. Although GraphQL comes
with set of default scalar types, sometimes it will be handy to be capable to declare our own. In order to be
able to handle that custom scalar type, we need to define how that scalar type will be serialized, and deserialized.</p>
</div>
<div class="paragraph">
<p>The following schema shows what is the path that a query execution follows from the query request until the scalar
value has been serialized to send the response back to the client.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/diag-676ed595bdba49c1655bbfacf6105406.png" alt="diag 676ed595bdba49c1655bbfacf6105406" width="1070" height="210">
</div>
</div>
<div class="paragraph">
<p>Now, when you define a Scalar what you&#8217;re doing is defining the deserialization functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>parseLiteral</code>: this function receives a query&#8217;s gql.ext.argument used as literal (as oppose as using a query variable)</p>
</li>
<li>
<p><code>parseValue</code>: this function receives a query&#8217;s gql.ext.argument used as a variable</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You will also have to define the serialization method <code>serialize</code> which receives the result of executing a data
fetcher or from a static value and converts back the value to something meaningul to the client.</p>
</div>
<div class="sect3">
<h4 id="_declaration">3.2.1. Declaration</h4>
<div class="paragraph">
<p>When declaring a type you can set every field in it, and most of the time they will be whether built-in
scalars (<code>GraphQLString</code> or <code>GraphQLFloat</code>) or custom scalars like <code>GraphQLPrice</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> orderType = DSL.type(<span class="string"><span class="delimiter">'</span><span class="content">Order</span><span class="delimiter">'</span></span>) {
  field <span class="string"><span class="delimiter">'</span><span class="content">subject</span><span class="delimiter">'</span></span>, GraphQLString <i class="conum" data-value="1"></i><b>(1)</b>
  field <span class="string"><span class="delimiter">'</span><span class="content">units</span><span class="delimiter">'</span></span>, GraphQLInt <i class="conum" data-value="2"></i><b>(2)</b>
  field <span class="string"><span class="delimiter">'</span><span class="content">price</span><span class="delimiter">'</span></span>, GraphQLPrice <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><strong>subject</strong>: A string describing what is this order about</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><strong>units</strong>: Number of items of this order</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><strong>price</strong>: Unit price for each item</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>GraphQLPrice</code> scalar has been defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> GraphQLPrice = DSL.scalar(<span class="string"><span class="delimiter">'</span><span class="content">Price</span><span class="delimiter">'</span></span>) { <i class="conum" data-value="1"></i><b>(1)</b>
  description <span class="string"><span class="delimiter">'</span><span class="content">currency unit</span><span class="delimiter">'</span></span> <i class="conum" data-value="2"></i><b>(2)</b>

  <span class="comment">// deserialization</span>
  parseLiteral <span class="local-variable">this</span>.&amp;stringValueToMap <i class="conum" data-value="3"></i><b>(3)</b>
  parseValue <span class="local-variable">this</span>.&amp;stringValueToMap <i class="conum" data-value="4"></i><b>(4)</b>

  <span class="comment">// serialization</span>
  serialize <span class="local-variable">this</span>.&amp;fromMapToString <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Setting scalar&#8217;s name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Setting scalar&#8217;s description (optional)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Setting <code>parseLiteral</code> function (optional)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Setting <code>parseValue</code> function (optional)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Setting <code>serialize</code> function (optional)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Basically a scalar is a set of functions capable of deserializing a value, whether it&#8217;s coming from a literal
(parseLiteral) or a variable value (parseValue), and serializing a value as a response to the
initial request (serialize).</p>
</div>
</div>
<div class="sect3">
<h4 id="_deserialization">3.2.2. Deserialization</h4>
<div class="sect4">
<h5 id="_literals">Literals</h5>
<div class="paragraph">
<p>Now think of a situation where you want to set the price of a given product including the currency symbol, for instance
 <code>1.23Y</code>. But of course it would be nice to have an automatic mechanism that keeps apart both number and symbol,
 otherwise you could end up parsing that literal everywhere. So given the following query, which has a literal
 containing a monetary concept:</p>
</div>
<div class="listingblock">
<div class="title">Query with a literal</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = <span class="string"><span class="delimiter">'''</span><span class="content">
  {
    order:changeOrderPrice(defaultPrice: &quot;1.23Y&quot;) {
      price
    }
  }
</span><span class="delimiter">'''</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We want to keep the information, but contained in a map so that we could handle the number and the symbol separately.
For that we use the <code>parseLiteral</code> function.</p>
</div>
<div class="listingblock">
<div class="title">parseLiteral</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> GraphQLPrice = DSL.scalar(<span class="string"><span class="delimiter">'</span><span class="content">Price</span><span class="delimiter">'</span></span>) {
  parseLiteral { money -&gt; <span class="comment">// 1.23Y</span>
    <span class="predefined-type">String</span> value = money.value <span class="comment">// from a StringValue</span>
    <span class="keyword">return</span> [
      <span class="key">unit</span>: <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>value</span><span class="delimiter">&quot;</span></span>[<span class="integer">0</span>..-<span class="integer">2</span>].toDouble(), <span class="comment">// 1.23</span>
      <span class="key">key</span>: <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>value</span><span class="delimiter">&quot;</span></span>[-<span class="integer">1</span>..-<span class="integer">1</span>], <span class="comment">// 'Y'</span>
    ]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>parseLiteral</code> function will parse every literal of a <code>Price</code> scalar and it will separate the number from the
symbol and if you use a data fetcher, it will receive a map instead of the initial literal.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">parseLiteral parameter</div>
<div class="paragraph">
<p>Literal values are converted into a valid GraphQL abstract syntax tree node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="graphql">{
 myQuery(name: &quot;john&quot;) {
   name
   address {
     street
   }
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>That means that a value like "john" in the previous query will be converted to a <code>graphql.language.StringValue</code>.
Whereas in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="graphql">{
 addRange(min: 10, max: 20) {
   id
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>10</code> and <code>20</code> will be converted to a <code>graphql.language.IntValue</code>. So bottom line you need to be aware of the types
of values that can be passed to your <code>parseLiteral</code> function, and create guard expressions to make sure you are
receiving the type you expect, because the signature of the <code>parseLiteral</code> function receives an <code>Object</code> as parameter.</p>
</div>
<div class="paragraph">
<p>To know more about the different node values you can receive in that method you should take a look at the implementation
of <code>graphql-java</code> the package related to
<a href="https://github.com/graphql-java/graphql-java/tree/master/src/main/java/graphql/language">GraphQL nodes</a></p>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">fetcher</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> schema = DSL.schema {
  queries {
    field(<span class="string"><span class="delimiter">'</span><span class="content">changeOrderPrice</span><span class="delimiter">'</span></span>) {
      type orderType
      fetcher { env -&gt;
        <span class="comment">// already converted :)</span>
        <span class="keyword">def</span> price = env.arguments.defaultPrice <span class="comment">// [unit: 1.23, key: 'Y']</span>

        [<span class="key">subject</span>: <span class="string"><span class="delimiter">'</span><span class="content">paper</span><span class="delimiter">'</span></span>, <span class="key">price</span>: price]
      }
      argument <span class="string"><span class="delimiter">'</span><span class="content">defaultPrice</span><span class="delimiter">'</span></span>, GraphQLPrice
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_variables">Variables</h5>
<div class="paragraph">
<p>Literals are a easy and quick way of passing values to a query, but, if you wanted to reuse query strings you would
want to use variables. And what happen if the value you want to convert is in a variable value ? Check this
query:</p>
</div>
<div class="listingblock">
<div class="title">Query with variables</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = <span class="string"><span class="delimiter">'''</span><span class="content">
  query ChangeOrderPrice($price: Price){
    order:changeOrderPrice(defaultPrice: $price) {
      price
    }
  }
</span><span class="delimiter">'''</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if look at the execution of the query:</p>
</div>
<div class="listingblock">
<div class="title">Query execution</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> result = DSL.execute(
  schema,
  query,
  [<span class="key">price</span>: <span class="string"><span class="delimiter">'</span><span class="content">1.25PTA</span><span class="delimiter">'</span></span>],
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now how can I convert that string value coming from a variable to a map that I could receive in my data fetcher:</p>
</div>
<div class="listingblock">
<div class="title">parseValue</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> scalar = DSL.scalar(<span class="string"><span class="delimiter">'</span><span class="content">Price</span><span class="delimiter">'</span></span>) {
  parseValue { <span class="predefined-type">String</span> value -&gt; <span class="comment">// '1.25PTA'</span>
    <span class="keyword">return</span> [
      <span class="key">unit</span>: value[<span class="integer">0</span>..-<span class="integer">4</span>].toDouble(), <span class="comment">// 1.25</span>
      <span class="key">key</span>: value[-<span class="integer">1</span>..-<span class="integer">3</span>].reverse(), <span class="comment">// 'PTA'</span>
    ]
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<code>parseLiteral</code> parameters are simple Java parameters, not GraphQL node values as they were for the
 <code>parseLiteral</code> function
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally I can get the parsed value in the data fetcher:</p>
</div>
<div class="listingblock">
<div class="title">fetcher</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> schema = DSL.schema {
  queries {
    field(<span class="string"><span class="delimiter">'</span><span class="content">changeOrderPrice</span><span class="delimiter">'</span></span>) {
      type orderType
      fetcher { env -&gt;
        <span class="keyword">def</span> price = env.arguments.defaultPrice <span class="comment">// already converted :)</span>

        [<span class="key">subject</span>: <span class="string"><span class="delimiter">'</span><span class="content">paper</span><span class="delimiter">'</span></span>, <span class="key">price</span>: price]
      }
      argument <span class="string"><span class="delimiter">'</span><span class="content">defaultPrice</span><span class="delimiter">'</span></span>, scalar
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_serialization">3.2.3. Serialization</h4>
<div class="paragraph">
<p>We&#8217;ve been reviewing how to parse data coming from a query to something we can deal with. Serialization would be
the opposite action, convert a given value produced by us into something meaninful to the client.</p>
</div>
<div class="paragraph">
<p>Following the same examples, we now the client is dealing with figures like: <code>1.23Y</code> or <code>1.25PTA</code>. But the problem
is that we&#8217;re producing tuples like: [unit:1.23, key: 'Y']. That cannot be rendered by the client, we need to convert
a given tuple to a meaninful literal with the <code>serialize</code> function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> GraphQLPrice = DSL.scalar(<span class="string"><span class="delimiter">'</span><span class="content">Price</span><span class="delimiter">'</span></span>) { <i class="conum" data-value="1"></i><b>(1)</b>
  description <span class="string"><span class="delimiter">'</span><span class="content">currency unit</span><span class="delimiter">'</span></span> <i class="conum" data-value="2"></i><b>(2)</b>

  <span class="comment">// serialization</span>
  serialize { money -&gt; <span class="comment">// [unit: 1.23, key: '$'] </span><i class="conum" data-value="3"></i><b>(3)</b>
    <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>money.unit<span class="inline-delimiter">}</span></span><span class="inline"><span class="inline-delimiter">${</span>money.key<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> <span class="comment">// &quot;1.23$&quot; </span><i class="conum" data-value="4"></i><b>(4)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declaring the <code>Price</code> scalar type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Adding a description</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Adding <code>serialize</code> function</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Value return as response</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The function passed as an gql.ext.argument to the <code>serialize</code> method will take whatever value is coming from the data fetcher
 or static value of the field and it will return the way you&#8217;d like to serialize that value to the client.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_enums">3.3. Enums</h3>
<div class="paragraph">
<p>Also called Enums, enumeration types are a special kind of scalar that is restricted to a particular set of allowed
values. You can define a enum type with <code>DSL.enum</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">gql.DSL</span>
<span class="keyword">import</span> <span class="include">graphql.schema.GraphQLEnumType</span>

GraphQLEnumType CountryEnumType = DSL.enum(<span class="string"><span class="delimiter">'</span><span class="content">Countries</span><span class="delimiter">'</span></span>) {
  description <span class="string"><span class="delimiter">'</span><span class="content">european countries</span><span class="delimiter">'</span></span>

  value <span class="string"><span class="delimiter">'</span><span class="content">SPAIN</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">es</span><span class="delimiter">'</span></span>
  value <span class="string"><span class="delimiter">'</span><span class="content">FRANCE</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">fr</span><span class="delimiter">'</span></span>
  value <span class="string"><span class="delimiter">'</span><span class="content">GERMANY</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">de</span><span class="delimiter">'</span></span>
  value <span class="string"><span class="delimiter">'</span><span class="content">UK</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">uk</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can use that type as any other type for your type&#8217;s fields</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">gql.DSL</span>
<span class="keyword">import</span> <span class="include">graphql.schema.GraphQLObjectType</span>

GraphQLObjectType journey = DSL.type(<span class="string"><span class="delimiter">'</span><span class="content">Journey</span><span class="delimiter">'</span></span>) {
  field <span class="string"><span class="delimiter">'</span><span class="content">country</span><span class="delimiter">'</span></span>, CountryEnumType
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_schemas">3.4. Schemas</h3>
<div class="paragraph">
<p>Once we&#8217;ve defined the structure of the data we want to expose, we need to define
how that data is going to be retrieved. The schema defines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Which types are exposed</strong></p>
</li>
<li>
<p><strong>How to interact with that data</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Data is exposed as <strong>queries</strong> or <strong>mutations</strong> depending on whether the action is just a query or a request asking for
creating/modifying data. Queries are declared as fields under the <strong>query</strong> node and mutations are also declared as
fields under the <strong>mutation</strong> node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">gql.DSL</span>
<span class="keyword">import</span> <span class="include">graphql.schema.GraphQLSchema</span>

GraphQLSchema schema = DSL.schema {
  queries { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="comment">// no queries</span>
  }
  mutations { <i class="conum" data-value="2"></i><b>(2)</b>
    field(<span class="string"><span class="delimiter">'</span><span class="content">insert</span><span class="delimiter">'</span></span>) {
      type filmType
      fetcher { DataFetchingEnvironment env -&gt;
        <span class="keyword">def</span> name = env.arguments.name
        people &lt;&lt; name
        <span class="keyword">return</span> [<span class="key">name</span>: name]
      }
      argument <span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, GraphQLString
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Queries</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Mutations</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Altough mutation node is optional, the query node is mandatory (could be empty but should be present)
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Both <code>queries</code> and <code>mutations</code> have a default name: <code>Queries</code> and <code>Mutations</code> respectively. But you
can pass a custom name if you want, for instance <code>queries('CustomQueryRoot') { }</code> or <code>mutations('MutationRoot') { }</code>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_static_values">3.4.1. Static values</h4>
<div class="paragraph">
<p>Sometimes you may want to expose constant values, values that are unlikely to change.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">gql.DSL</span>
<span class="keyword">import</span> <span class="include">graphql.schema.GraphQLSchema</span>

GraphQLSchema schema = DSL.schema { <i class="conum" data-value="1"></i><b>(1)</b>
  queries(<span class="string"><span class="delimiter">'</span><span class="content">helloQuery</span><span class="delimiter">'</span></span>) { <i class="conum" data-value="2"></i><b>(2)</b>
    description<span class="string"><span class="delimiter">'</span><span class="content">simple droid</span><span class="delimiter">'</span></span><i class="conum" data-value="3"></i><b>(3)</b>

    field(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) { <i class="conum" data-value="4"></i><b>(4)</b>
      description<span class="string"><span class="delimiter">'</span><span class="content">name of the droid</span><span class="delimiter">'</span></span>
      type GraphQLString
      staticValue <span class="string"><span class="delimiter">'</span><span class="content">world</span><span class="delimiter">'</span></span>
    }

  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declares a schema</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declares the query root node <code>helloQuery</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Adds a description to the <code>helloQuery</code> node</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Declares a single query called <code>hello</code> which exposes a value <code>world</code> of type GraphQLString</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this example we are exposing just a single scalar value, but most of the time we will be
exposing data through calls to underlying datastore engines. We&#8217;ll see how to do it in a bit.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_fetchers">3.4.2. Fetchers</h4>
<div class="paragraph">
<p>Most of the time we are fetching our data from a database, a micro-service, a csv file&#8230;&#8203;etc and we normally use
an API to query these datastores invoking some functions.</p>
</div>
<div class="paragraph">
<p>Now the same way we were able to expose static values using
the <code>staticValue</code> method in the DSL, we will be able to get data from a dynamic source via <code>fetcher</code>.</p>
</div>
<div class="paragraph">
<p>The gql.ext.argument of <code>fetcher</code> is an instance of type <code>graphql.schema.DataFetcher</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">graphql.schema</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">DataFetcher</span>&lt;T&gt; {
    T get(DataFetchingEnvironment environment);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because <code>DataFetcher</code> is a
<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/FunctionalInterface.html">functional interface</a> it is
possible to use the following options as arguments of the <code>fetcher</code> method:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A closure</p>
</li>
<li>
<p>A method closure</p>
</li>
<li>
<p>An instance of an implementation of <code>DataFetcher</code></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_as_a_closure">As a closure</h5>
<div class="paragraph">
<p>The closure receives a <code>graphql.schema.DataFetchingEnvironment</code> instance as parameter and will return the requested
data. The requested data should be of the same type of the declared type, or a map that complies with the defined type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">gql.DSL</span>
<span class="keyword">import</span> <span class="include">graphql.schema.GraphQLSchema</span>

GraphQLSchema schema = DSL.schema {
  queries(<span class="string"><span class="delimiter">'</span><span class="content">QueryRoot</span><span class="delimiter">'</span></span>) {
    description<span class="string"><span class="delimiter">'</span><span class="content">queries over James Bond</span><span class="delimiter">'</span></span>
    field(<span class="string"><span class="delimiter">'</span><span class="content">lastFilm</span><span class="delimiter">'</span></span>) {
      description<span class="string"><span class="delimiter">'</span><span class="content">last film</span><span class="delimiter">'</span></span>
      type filmType
      fetcher { env -&gt; [<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">SPECTRE</span><span class="delimiter">'</span></span>] }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_as_a_method_closure">As a method closure</h5>
<div class="paragraph">
<p>A method closure is like a Java&#8217;s method reference. It represents a function that can be passed as parameter to another
function.</p>
</div>
<div class="paragraph">
<p>The function should obey the signature of the <code>DataFetcher#get</code> method (receiving a DataFetchingEnvironment
as only parameter and returning an object of the correct type).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">gql.DSL</span>
<span class="keyword">import</span> <span class="include">graphql.schema.GraphQLSchema</span>

GraphQLSchema schema = DSL.schema {
  queries(<span class="string"><span class="delimiter">'</span><span class="content">QueryRoot</span><span class="delimiter">'</span></span>) {
    description<span class="string"><span class="delimiter">'</span><span class="content">queries over James Bond</span><span class="delimiter">'</span></span>
    field(<span class="string"><span class="delimiter">'</span><span class="content">lastFilm</span><span class="delimiter">'</span></span>) {
      description<span class="string"><span class="delimiter">'</span><span class="content">last film</span><span class="delimiter">'</span></span>
      type filmType
      fetcher Queries.&amp;findLastFilm
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_environment">Environment</h5>
<div class="paragraph">
<p>Is very important to be aware of this object because it holds information about the requested query, such as the
arguments, the query types, extra information added to the fetcher context (it could be used to store
user information for example)&#8230;&#8203;etc.</p>
</div>
<div class="paragraph">
<p>In the following schema declaration, we are using a fetcher that eventually will need to get a year to be able
to get the proper film:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">gql.DSL</span>
<span class="keyword">import</span> <span class="include">graphql.schema.GraphQLSchema</span>

GraphQLSchema schema = DSL.schema {
  queries {
    field(<span class="string"><span class="delimiter">'</span><span class="content">byYear</span><span class="delimiter">'</span></span>) {
      type filmType
      fetcher Queries.&amp;findByYear
      argument <span class="string"><span class="delimiter">'</span><span class="content">year</span><span class="delimiter">'</span></span>, GraphQLString
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we look to the method&#8217;s implementation, we&#8217;ll see how the <code>DataFetchingEnvironment</code> has a <code>getArguments()</code> method
returning a Map with the arguments values stored by their names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">graphql.schema.DataFetchingEnvironment</span>

<span class="directive">static</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>,?&gt; findByYear(DataFetchingEnvironment env) {
  <span class="predefined-type">String</span> year = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>env.arguments.year<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>

  <span class="predefined-type">List</span>&lt;<span class="predefined-type">Map</span>&gt; dataSet = loadBondFilms()
  <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>,?&gt; filmByYear = dataSet.find(byYear(year))

  <span class="keyword">return</span> filmByYear
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>DataFetchingEnvironment</code> object has a few more options that are worth knowing. I would recommend
you to take a look at the source code
<a href="https://github.com/graphql-java/graphql-java/blob/master/src/main/java/graphql/schema/DataFetchingEnvironment.java">here</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_good_practices">3.4.3. Good practices</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_modularising">3.5. Modularising</h3>
<div class="paragraph">
<p>Modularising the way you create GraphQL schemas has at least a couple of benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Enables you to write using plain GraphQL language</strong>: Writing code is cool, but you may be used to writing GraphQL schemas
using the GraphQL language directly.</p>
</li>
<li>
<p><strong>It allows you to separate parts of the schema by areas of interest</strong>: No more a huge single file declaring
everything in one place</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Lets say we have three different schema files in our classpath, and we would like to merge them all in order to
create a sigle schema:</p>
</div>
<div class="listingblock">
<div class="title">films</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">type Film {
  <span class="key">title</span>: <span class="predefined-type">String</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">bands</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">scalar CustomDate

type Band {
  <span class="key">name</span>: <span class="predefined-type">String</span>
  <span class="key">createdAt</span>: CustomDate
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">qandm.graphqls</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">type Queries {
  <span class="key">randomBand</span>: Band
  <span class="key">randomFilm</span>: Film
}

schema {
  <span class="key">query</span>: Queries
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this first example we will be using <code>java.util.URI</code> instances to locate our files, but as we will see later,
we can just use a <code>java.lang.String</code> to indicate where those files are within the application class loader.</p>
</div>
<div class="listingblock">
<div class="title">as URIs</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">URI</span> uriOne = <span class="predefined-type">ClassLoader</span>.getSystemResource(<span class="string"><span class="delimiter">'</span><span class="content">gql/dsl/bands.graphqls</span><span class="delimiter">'</span></span>).toURI()
<span class="predefined-type">URI</span> uriTwo = <span class="predefined-type">ClassLoader</span>.getSystemResource(<span class="string"><span class="delimiter">'</span><span class="content">gql/dsl/films.graphqls</span><span class="delimiter">'</span></span>).toURI()
<span class="predefined-type">URI</span> uriTop = <span class="predefined-type">ClassLoader</span>.getSystemResource(<span class="string"><span class="delimiter">'</span><span class="content">gql/dsl/qandm.graphqls</span><span class="delimiter">'</span></span>).toURI()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can merge all of them. In this example we&#8217;ll only be mapping the query fields with the data fetchers
needed to return some response.</p>
</div>
<div class="listingblock">
<div class="title">as URIs</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">gql.DSL</span>

GraphQLSchema proxySchema = DSL.mergeSchemas {
  scalar(CustomDate)

  byURI(uriOne)   <i class="conum" data-value="1"></i><b>(1)</b>
  byURI(uriTwo)
  byURI(uriTop) { <i class="conum" data-value="2"></i><b>(2)</b>
    mapType(<span class="string"><span class="delimiter">'</span><span class="content">Queries</span><span class="delimiter">'</span></span>) { <i class="conum" data-value="3"></i><b>(3)</b>
      link(<span class="string"><span class="delimiter">'</span><span class="content">randomFilm</span><span class="delimiter">'</span></span>) { DataFetchingEnvironment env -&gt; <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="keyword">return</span> [<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Spectre</span><span class="delimiter">'</span></span>]
      }
      link(<span class="string"><span class="delimiter">'</span><span class="content">randomBand</span><span class="delimiter">'</span></span>) { DataFetchingEnvironment env -&gt;
        <span class="keyword">return</span> [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Whitesnake</span><span class="delimiter">'</span></span>]
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Merging schema fragment (only type definitions)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Merging another schema fragment but, this time, mapping inner types to some data fetchers</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Declaring the interest to map some of the fields of type <code>QueryType</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Mapping a given data fetcher to field <code>randomField</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And using just strings to indicate where the files are in the classpath:</p>
</div>
<div class="listingblock">
<div class="title">as URIs</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">gql.DSL</span>

GraphQLSchema proxySchema = DSL.mergeSchemas {
  scalar(CustomDate)
  byResource(<span class="string"><span class="delimiter">'</span><span class="content">gql/dsl/bands.graphqls</span><span class="delimiter">'</span></span>)
  byResource(<span class="string"><span class="delimiter">'</span><span class="content">gql/dsl/films.graphqls</span><span class="delimiter">'</span></span>)
  byResource(<span class="string"><span class="delimiter">'</span><span class="content">gql/dsl/qandm.graphqls</span><span class="delimiter">'</span></span>) {
    mapType(<span class="string"><span class="delimiter">'</span><span class="content">Queries</span><span class="delimiter">'</span></span>) {
      link(<span class="string"><span class="delimiter">'</span><span class="content">randomFilm</span><span class="delimiter">'</span></span>) { DataFetchingEnvironment env -&gt;
        <span class="keyword">return</span> [<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Spectre</span><span class="delimiter">'</span></span>]
      }
      link(<span class="string"><span class="delimiter">'</span><span class="content">randomBand</span><span class="delimiter">'</span></span>) { DataFetchingEnvironment env -&gt;
        <span class="keyword">return</span> [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Whitesnake</span><span class="delimiter">'</span></span>]
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_custom_scalar_implementation">3.5.1. Custom Scalar implementation</h4>
<div class="paragraph">
<p>If you&#8217;d like to add a custom scalar implementation when using the
modularization mechanism, you can do it from version
<code>0.1.9-alpha</code>. All you have to do is:</p>
</div>
<div class="paragraph">
<p>Declare the scalar in the schema:</p>
</div>
<div class="listingblock">
<div class="title">IDL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">scalar CustomDate

type Band {
  <span class="key">name</span>: <span class="predefined-type">String</span>
  <span class="key">createdAt</span>: CustomDate
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then create the scalar implementation with the Groovy DSL:</p>
</div>
<div class="listingblock">
<div class="title">Custom scalar</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> GraphQLScalarType CustomDate = DSL.scalar(<span class="string"><span class="delimiter">'</span><span class="content">CustomDate</span><span class="delimiter">'</span></span>) {
  serialize { <span class="predefined-type">Date</span> date -&gt;
    date.format(<span class="string"><span class="delimiter">'</span><span class="content">dd/MM/yyyy</span><span class="delimiter">'</span></span>)
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And finally add the reference to the <code>DSL.mergeSchemas</code> body:</p>
</div>
<div class="listingblock">
<div class="title">Schema</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">GraphQLSchema proxySchema = DSL.mergeSchemas {
  scalar(CustomDate)

  byResource(<span class="string"><span class="delimiter">'</span><span class="content">gql/dsl/bands.graphqls</span><span class="delimiter">'</span></span>)
  byResource(<span class="string"><span class="delimiter">'</span><span class="content">gql/dsl/films.graphqls</span><span class="delimiter">'</span></span>)
  byURI(schemaRootUri) {
    mapType(<span class="string"><span class="delimiter">'</span><span class="content">Queries</span><span class="delimiter">'</span></span>) {
      link(<span class="string"><span class="delimiter">'</span><span class="content">randomBand</span><span class="delimiter">'</span></span>) { DataFetchingEnvironment env -&gt;
        <span class="keyword">return</span> [
          <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Whitesnake</span><span class="delimiter">'</span></span>,
          <span class="key">createdAt</span>: <span class="predefined-type">Date</span>.parse(<span class="string"><span class="delimiter">'</span><span class="content">dd-MM-yyyy</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">01-01-1977</span><span class="delimiter">'</span></span>)
        ]
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_inputs">3.6. Inputs</h3>
<div class="paragraph">
<p>Apart from using scalar values, like enums or string when passing arguments to a given query
you can also easily pass complex objects. This is particularly valuable in the case of mutations, where
you might want to pass in a whole object to be created. In GraphQL that means using input types.</p>
</div>
<div class="paragraph">
<p>Lets say we have a query to filter our mail inbox by <code>from</code> and <code>to</code>:</p>
</div>
<div class="listingblock">
<div class="title">query</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = <span class="string"><span class="delimiter">'''</span><span class="content">
query QueryMail($filter: MailFilter) {
    result: searchByFilter(filter: $filter) {
       subject
    }
}
</span><span class="delimiter">'''</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can model the <code>MailFilter</code> input type as:</p>
</div>
<div class="listingblock">
<div class="title">declaration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">GraphQLInputObjectType MailFilterType = DSL.input(<span class="string"><span class="delimiter">'</span><span class="content">MailFilter</span><span class="delimiter">'</span></span>) {
  field <span class="string"><span class="delimiter">'</span><span class="content">from</span><span class="delimiter">'</span></span>, GraphQLString
  field <span class="string"><span class="delimiter">'</span><span class="content">to</span><span class="delimiter">'</span></span>, GraphQLString
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And finally when executing the query we can pass a map with the mail filter values.</p>
</div>
<div class="listingblock">
<div class="title">execution</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ExecutionResult result =
  DSL.execute(schema, query, [<span class="key">filter</span>: [<span class="key">from</span>: <span class="string"><span class="delimiter">'</span><span class="content">me@somedomain.com</span><span class="delimiter">'</span></span>, <span class="key">to</span>: <span class="string"><span class="delimiter">'</span><span class="content">you@somedomain.com</span><span class="delimiter">'</span></span>]])</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_arguments">3.6.1. Arguments</h4>
<div class="paragraph">
<p>Input types can only be used as an argument of a <code>query</code> or a <code>mutation</code>. Therefore when
declaring a given mutation, you can say that the argument of that <code>query</code> or <code>mutation</code>
can be of input type <code>X</code>:</p>
</div>
<div class="listingblock">
<div class="title">arguments</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">GraphQLSchema schema = DSL.schema {
  queries {
    field(<span class="string"><span class="delimiter">'</span><span class="content">searchByFilter</span><span class="delimiter">'</span></span>) {
      type list(MailResult)

      argument <span class="string"><span class="delimiter">'</span><span class="content">filter</span><span class="delimiter">'</span></span>, MailFilterType <span class="comment">// --&gt; input type</span>

      fetcher { DataFetchingEnvironment env -&gt;
        <span class="keyword">assert</span> env.arguments.filter.from == <span class="string"><span class="delimiter">'</span><span class="content">me@somedomain.com</span><span class="delimiter">'</span></span>
        <span class="keyword">assert</span> env.arguments.filter.to == <span class="string"><span class="delimiter">'</span><span class="content">you@somedomain.com</span><span class="delimiter">'</span></span>

        <span class="keyword">return</span> [[<span class="key">subject</span>: <span class="string"><span class="delimiter">'</span><span class="content">just this email here!</span><span class="delimiter">'</span></span>]]
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Why there is no <code>type</code> method inside <code>argument</code> ?</div>
<div class="paragraph">
<p>In previous versions there was the possibility of doing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">field(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) {
   type outputType <span class="comment">// --&gt; output</span>
   argument(<span class="string"><span class="delimiter">'</span><span class="content">argumentName</span><span class="delimiter">'</span></span>) {
     type inputType <span class="comment">// --&gt; input? output?</span>
     description <span class="string"><span class="delimiter">'</span><span class="content">description</span><span class="delimiter">'</span></span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>But that led to ambiguity, specially because the user could think any type could be used
as an argument. That&#8217;s why it&#8217;s been removed, and even the upper <code>type</code> method is not visible
inside the <code>argument</code> scope</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_queries">3.7. Queries</h3>
<div class="sect3">
<h4 id="_execution">3.7.1. Execution</h4>
<div class="sect4">
<h5 id="_withouth_arguments">Withouth arguments</h5>
<div class="paragraph">
<p>In order to execute a given query string you can use <code>DSL.execute(schema, string)</code>. Given a query:</p>
</div>
<div class="listingblock">
<div class="title">query</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> queryString = <span class="string"><span class="delimiter">'''</span><span class="content">
  {
    lastFilm {
      title
    }
  }
</span><span class="delimiter">'''</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can execute it against a given schema as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">gql.DSL</span>

ExecutionResult result = DSL.execute(schema, queryString) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, ?&gt; dataMap = result.data <i class="conum" data-value="2"></i><b>(2)</b>
<span class="predefined-type">List</span>&lt;?&gt; errors = result.errors <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The result of executing a query is a <code>graphql.ExecutionResult</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The result could contain some data</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Or could contain GraphQL errors</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">ExecutionResult#getData()</div>
<div class="paragraph">
<p>ExecutionResult <code>getData()</code> method has the following signature</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;T&gt; T getData()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which means that, in a variable declaration, the right operand will be automatically casted to the type of the
left operand. This is useful if you want to use static compilation, but also dangerous if you&#8217;re not sure of the type
data is going to return.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_with_arguments">With arguments</h5>
<div class="paragraph">
<p>In order to execute a given query with arguments you can use <code>DSL.execute(schema, string, variables)</code>:</p>
</div>
<div class="listingblock">
<div class="title">query</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> queryString = <span class="string"><span class="delimiter">'''</span><span class="content">
  query FindBondByYear($year: String) {
    byYear(year: $year) {
      year
      title
    }
  }
</span><span class="delimiter">'''</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">execution</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> result = DSL.execute(schema, queryString, [<span class="key">year</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1962</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_asynchronous_execution">3.7.2. Asynchronous Execution</h4>
<div class="paragraph">
<p>GQL through <code>graphql-java</code> can use fully asynchronous execution when
executing queries. You can get a
<code>java.util.concurrent.CompleteableFuture</code> of an <code>ExecutionResult</code> by
calling <code>DSL.executeAsync()</code> like this:</p>
</div>
<div class="paragraph">
<p>If a data fetcher returns a CompletableFuture&lt;T&gt; object then this will
be composed into the overall asynchronous query execution. This means
you can fire off a number of field fetching requests in
parallel. Exactly what threading strategy you use is up to your data
fetcher code.</p>
</div>
</div>
<div class="sect3">
<h4 id="_query_builders">3.7.3. Query builders</h4>
<div class="paragraph">
<p><strong>GQL</strong> allows you to execute queries directly or to build them to use them later via DSL
builder. The former is useful if you already have the queries and you
are sure they work as expected. The latter is a safer way of building
queries because it gives you some sanity checks based on the types
used.</p>
</div>
<div class="sect4">
<h5 id="_execute_queries">Execute queries</h5>
<div class="paragraph">
<p>If you&#8217;re using the underlying <strong>GQL</strong> GraphQL engine to execute your queries, it would be nice
to be able to declare and execute queries in one shot right ?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">gql.DSL</span>
<span class="keyword">import</span> <span class="include">graphql.ExecutionResult</span>
<span class="keyword">import</span> <span class="include">graphql.schema.DataFetchingEnvironment</span>

ExecutionResult result = DSL.execute(schema) {
  query(<span class="string"><span class="delimiter">'</span><span class="content">byYear</span><span class="delimiter">'</span></span>, [<span class="key">year</span>: <span class="string"><span class="delimiter">'</span><span class="content">1962</span><span class="delimiter">'</span></span>]) { <i class="conum" data-value="1"></i><b>(1)</b>
    returns(Film) { <i class="conum" data-value="2"></i><b>(2)</b>
      title
      year
    }

    alias <span class="string"><span class="delimiter">'</span><span class="content">first</span><span class="delimiter">'</span></span> <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines a <code>query</code> with name <code>byYear</code> mapping query parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Checks that the fields used in the close are present in type <code>Film</code>. Uses static check to make sure fields are
present in type <code>Film</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Defines a given alias to the query result</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">gql.DSL</span>
<span class="keyword">import</span> <span class="include">graphql.ExecutionResult</span>
<span class="keyword">import</span> <span class="include">graphql.schema.DataFetchingEnvironment</span>

ExecutionResult result2 = DSL.execute(schema) {
  query(<span class="string"><span class="delimiter">'</span><span class="content">byYear</span><span class="delimiter">'</span></span>, [<span class="key">year</span>: <span class="string"><span class="delimiter">'</span><span class="content">2015</span><span class="delimiter">'</span></span>]) { <i class="conum" data-value="1"></i><b>(1)</b>
    returns { <i class="conum" data-value="2"></i><b>(2)</b>
      title
      year
      bond
    }

    alias <span class="string"><span class="delimiter">'</span><span class="content">last</span><span class="delimiter">'</span></span> <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines a <code>query</code> with name <code>lastFilm</code> mapping variables</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declares a set of fields but are not checked</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Defines a given alias to the query result</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_query_string">Query string</h5>
<div class="paragraph">
<p>Sometimes your exposed GraphQL schema may be backed up by another third party GraphQL engine implementation, but
instead of writing or queries by hand we still may want to use the DSL to build the query and then use the resulting
string against the other engine.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">gql.DSL</span>

<span class="predefined-type">String</span> queryString = DSL.buildQuery {
  query(<span class="string"><span class="delimiter">'</span><span class="content">byYear</span><span class="delimiter">'</span></span>, [<span class="key">year</span>: <span class="string"><span class="delimiter">'</span><span class="content">1962</span><span class="delimiter">'</span></span>]) {
    returns(Film) {
      title
      year
    }
    alias <span class="string"><span class="delimiter">'</span><span class="content">first</span><span class="delimiter">'</span></span>
  }

  query(<span class="string"><span class="delimiter">'</span><span class="content">byYear</span><span class="delimiter">'</span></span>, [<span class="key">year</span>: <span class="string"><span class="delimiter">'</span><span class="content">2015</span><span class="delimiter">'</span></span>]) {
    returns {
      title
      year
      bond
    }
    alias <span class="string"><span class="delimiter">'</span><span class="content">last</span><span class="delimiter">'</span></span>
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_relay">4. Relay</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_relay">4.1. What is Relay ?</h3>
<div class="paragraph">
<p><a href="https://facebook.github.io/react/blog/2015/02/20/introducing-relay-and-graphql.html" class="bare">https://facebook.github.io/react/blog/2015/02/20/introducing-relay-and-graphql.html</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_what_gql_implements">4.2. What GQL implements ?</h3>
<div class="paragraph">
<p>According to the <a href="https://facebook.github.io/relay/">Relay</a> official site, the three core
assumptions that Relay makes about a GraphQL server are that it provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <strong>mechanism for refetching</strong> an object.</p>
</li>
<li>
<p>A description of <strong>how to page</strong> through connections.</p>
</li>
<li>
<p>Structure around <strong>mutations</strong> to make them <strong>predictable</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Relay uses GraphQL as its query language, but it is not tied to a specific implementation of GraphQL. In order to
achieve these three goals, the Relay specification defines three conceps: <strong>Node</strong>, <strong>Connection</strong>, <strong>Edges</strong>.</p>
</div>
<div class="paragraph">
<p>You can think of the relationship between the three terms looking at this diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/diag-2ef57b407f6f08c1248d3f6d37379067.png" alt="diag 2ef57b407f6f08c1248d3f6d37379067" width="680" height="140">
</div>
</div>
<div class="paragraph">
<p>A <strong>Node</strong> may have a <strong>Connection</strong> and a <strong>Connection</strong> may have 0 to N <strong>Edges</strong>. Lets see what these
terms mean.</p>
</div>
</div>
<div class="sect2">
<h3 id="_node">4.3. Node</h3>
<div class="paragraph">
<p>A <strong>Node</strong> is a type that can be retrieved by an unique identifier. Therefore a node always has an <strong>id</strong> field.</p>
</div>
<div class="paragraph">
<p>Apart from the <strong>id</strong> field, a node can have more fields. However there&#8217;s a special type of node field
called <strong>connection</strong>. A <strong>Connection</strong> is a type of fields mapping one-to-many relationships.
Here&#8217;s an example on how to declare a new node:</p>
</div>
<div class="listingblock">
<div class="title">Simple Node</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">GraphQLOutputType Faction = Relay.node(<span class="string"><span class="delimiter">'</span><span class="content">Faction</span><span class="delimiter">'</span></span>) { <i class="conum" data-value="1"></i><b>(1)</b>
  description <span class="string"><span class="delimiter">'</span><span class="content">party spirit especially when marked by dissension</span><span class="delimiter">'</span></span>

  field <span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, GraphQLString
  field <span class="string"><span class="delimiter">'</span><span class="content">ships</span><span class="delimiter">'</span></span>, ShipConnection <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Node description</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Fields</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You don&#8217;t have to declare the <strong>id</strong> field. <strong>GQL</strong> has already added for you every
time you declare a node type.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Although you can always declare a connection as a normal field and build the connection type via the <code>DSL.connection()</code>
method, you can do it directly in the DSL like this:</p>
</div>
<div class="listingblock">
<div class="title">Node with embedded connection</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">GraphQLOutputType Faction = Relay.node(<span class="string"><span class="delimiter">'</span><span class="content">Faction</span><span class="delimiter">'</span></span>) {
  field <span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, GraphQLString <i class="conum" data-value="1"></i><b>(1)</b>
  connection(<span class="string"><span class="delimiter">'</span><span class="content">ships</span><span class="delimiter">'</span></span>) { <i class="conum" data-value="2"></i><b>(2)</b>
    type ShipConnection
    listFetcher { <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="predefined-type">Integer</span> limit = <span class="local-variable">it</span>.getArgument(<span class="string"><span class="delimiter">'</span><span class="content">first</span><span class="delimiter">'</span></span>)

      <span class="keyword">return</span> SHIPS.take(limit)
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declaring a normal field</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declaring a connection with connection edges' nodes of type <code>Ship</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Declaring a special fetcher to get the result</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_listfetcher">4.3.1. listFetcher</h4>
<div class="paragraph">
<p>To fetch the content of a <strong>connection</strong> field you can always use a simple data fetcher, but because a <strong>Connection</strong>
field has always some repetitive meta data, GQL has abstracted the way that metadata is created.</p>
</div>
<div class="paragraph">
<p>All you have to do is to make the <code>listFetcher { }</code> invocation to return a list of the edge items, then GQL will took
over and it will fulfill the information relative to <code>pageInfo</code> and <code>edges</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_connection">4.4. Connection</h3>
<div class="paragraph">
<p>A <strong>Connection</strong> is just a convention on how to access one-to-many relationships in a node, and how to
paginate through those items. A <strong>Connection</strong> has two fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>pageInfo</strong>: information regarding on how to paginate through the edges.</p>
</li>
<li>
<p><strong>edges</strong>: a collection of result items.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Every edge has two fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>cursor</strong>: identifies where in the pagination cursor is the edge located</p>
</li>
<li>
<p><strong>node</strong>: the edge payload</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">GraphQLOutputType ShipConnection = Relay.connection(<span class="string"><span class="delimiter">'</span><span class="content">ShipConnection</span><span class="delimiter">'</span></span>) { <i class="conum" data-value="1"></i><b>(1)</b>
  edges(<span class="string"><span class="delimiter">'</span><span class="content">Ship</span><span class="delimiter">'</span></span>) { <i class="conum" data-value="2"></i><b>(2)</b>
    description <span class="string"><span class="delimiter">'</span><span class="content">a starship</span><span class="delimiter">'</span></span>
    field <span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, GraphQLString
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declaring a connection type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declaring the type of the connection&#8217;s edge items</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Where is the <strong>ShipEdge</strong> type ?</div>
<div class="paragraph">
<p>Creating the intermediate type between connection and edge items is something repetitive. That&#8217;s why
the Relay dsl only let you declare the name of the item type. The convention says that the intermediate
type will be <strong>NameOfTheItemType</strong> + <strong>Edge</strong>. Therefore if the edges items are of type <strong>Ship</strong> the
edge type will be of type <strong>ShipEdge</strong>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_full_example">4.5. Full Example</h3>
<div class="paragraph">
<p>In this example we would like to get a certain number of the ships of the rebel faction.</p>
</div>
<div class="listingblock">
<div class="title">GraphQL query</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
     {
       rebels {
         name
         ships(first: </span><span class="inline"><span class="inline-delimiter">$</span>noResults</span><span class="content">) {
           pageInfo {
             hasNextPage
           }
           edges {
             cursor
             node {
               name
             }
           }
         }
       }
     }
  </span><span class="delimiter">&quot;&quot;&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So first thing to do is to declare the <strong>Faction</strong> type:</p>
</div>
<div class="listingblock">
<div class="title">Node</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">GraphQLOutputType Faction = Relay.node(<span class="string"><span class="delimiter">'</span><span class="content">Faction</span><span class="delimiter">'</span></span>) {
  field <span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, GraphQLString <i class="conum" data-value="1"></i><b>(1)</b>
  connection(<span class="string"><span class="delimiter">'</span><span class="content">ships</span><span class="delimiter">'</span></span>) { <i class="conum" data-value="2"></i><b>(2)</b>
    type ShipConnection
    listFetcher { <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="predefined-type">Integer</span> limit = <span class="local-variable">it</span>.getArgument(<span class="string"><span class="delimiter">'</span><span class="content">first</span><span class="delimiter">'</span></span>)

      <span class="keyword">return</span> SHIPS.take(limit)
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A faction has a <strong>name</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A faction has <strong>ships</strong> which is a one-to-many relationship</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Data fetcher</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <strong>Node</strong> types can declare a special type of fetcher, the <strong>listFetcher</strong>. That call can convert the
result of a simple function returning a list to a <strong>Connection</strong> type.</p>
</div>
<div class="paragraph">
<p>To declare a connection type you can use <strong>Relay.connection</strong>. In this example we&#8217;re declaring edges of type
<strong>ShipEdges</strong> which have nodes of type <strong>Ship</strong>.</p>
</div>
<div class="paragraph">
<p>Every edge item will have two fields: <strong>node</strong> which is every item of the relationship, and a <strong>cursor</strong> which is
a hash locating every edge in the relationship, it could be taken as if it were a kind of offset.</p>
</div>
<div class="listingblock">
<div class="title">Connection</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">GraphQLOutputType ShipConnection = Relay.connection(<span class="string"><span class="delimiter">'</span><span class="content">ShipConnection</span><span class="delimiter">'</span></span>) { <i class="conum" data-value="1"></i><b>(1)</b>
  edges(<span class="string"><span class="delimiter">'</span><span class="content">Ship</span><span class="delimiter">'</span></span>) { <i class="conum" data-value="2"></i><b>(2)</b>
    description <span class="string"><span class="delimiter">'</span><span class="content">a starship</span><span class="delimiter">'</span></span>
    field <span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, GraphQLString
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And finally declare the schema:</p>
</div>
<div class="listingblock">
<div class="title">Schema</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">GraphQLSchema schema = Relay.schema {
  queries {
    field(<span class="string"><span class="delimiter">'</span><span class="content">rebels</span><span class="delimiter">'</span></span>) {
      type Faction
      fetcher {
        <span class="keyword">return</span> [<span class="key">id</span>: <span class="string"><span class="delimiter">'</span><span class="content">RmFjdGlvbjox</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Alliance to Restore the Republic</span><span class="delimiter">'</span></span>]
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now when executing the query, that&#8217;s how the execution flow will be:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/diag-a1b1d993e3bdc4959ee957e749dcffd4.png" alt="diag a1b1d993e3bdc4959ee957e749dcffd4" width="990" height="140">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ratpack">5. Ratpack</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ratpack <a href="http://ratpack.io" class="bare">http://ratpack.io</a> is a set of Java libraries for building
scalable HTTP applications.</p>
</div>
<div class="paragraph">
<p>You can use Ratpack to make a given GraphQL schema available through
HTTP.</p>
</div>
<div class="sect2">
<h3 id="_example">5.1. Example</h3>
<div class="paragraph">
<p>Here is a minimum Groovy working example of a GraphQL schema exposed
through HTTP thanks to Ratpack.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Grapes</span>([
  <span class="annotation">@Grab</span>(<span class="string"><span class="delimiter">'</span><span class="content">io.ratpack:ratpack-groovy:1.5.1</span><span class="delimiter">'</span></span>),
  <span class="annotation">@Grab</span>(<span class="string"><span class="delimiter">'</span><span class="content">org.slf4j:slf4j-simple:1.7.25</span><span class="delimiter">'</span></span>),
  <span class="annotation">@Grab</span>(<span class="string"><span class="delimiter">'</span><span class="content">com.github.grooviter:gql-ratpack:0.3.0</span><span class="delimiter">'</span></span>)
])
<span class="keyword">import</span> <span class="include">static</span> <span class="include">ratpack.groovy.Groovy.ratpack</span>

<span class="keyword">import</span> <span class="include">gql.DSL</span>
<span class="keyword">import</span> <span class="include">gql.ratpack.GraphQLModule</span>
<span class="keyword">import</span> <span class="include">gql.ratpack.GraphQLHandler</span>
<span class="keyword">import</span> <span class="include">gql.ratpack.GraphiQLHandler</span>

<span class="keyword">def</span> schema = DSL.schema { <i class="conum" data-value="1"></i><b>(1)</b>
    queries(<span class="string"><span class="delimiter">'</span><span class="content">Queries</span><span class="delimiter">'</span></span>) {
      field(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
        type GraphQLString
        staticValue <span class="string"><span class="delimiter">'</span><span class="content">GraphQL and Groovy!</span><span class="delimiter">'</span></span>
      }
    }
}

ratpack {
    bindings {
      module GraphQLModule <i class="conum" data-value="2"></i><b>(2)</b>

      bindInstance schema <i class="conum" data-value="3"></i><b>(3)</b>
    }
    handlers {
        post(<span class="string"><span class="delimiter">'</span><span class="content">graphql</span><span class="delimiter">'</span></span>, GraphQLHandler) <i class="conum" data-value="4"></i><b>(4)</b>
        get(<span class="string"><span class="delimiter">'</span><span class="content">graphql/browser</span><span class="delimiter">'</span></span>, GraphiQLHandler) <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create the schema using <code>gql.DSL</code> api</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add the <code>gql.ratpack.GraphQLModule</code> in order to provide sane defaults to handlers and GraphiQL configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add the schema to Ratpack&#8217;s registry</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Register the <code>GraphQLHandler</code> to handle all GrahpQL request at <code>/graphql</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Register the <code>GraphiQLHandler</code> to be able to expose GraphiQL client at <code>/graphql/browser</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_execution_context">5.2. Execution context</h3>
<div class="paragraph">
<p><code>GQL</code> Ratpack integration uses the Ratpack&#8217;s handle context as the
GraphQL execution context. That enables to access Ratpack&#8217;s context from
a data fetcher.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">ratpack.handling.Context</span>
<span class="keyword">import</span> <span class="include">graphql.schema.DataFetchingEnvironment</span>

<span class="keyword">def</span> schema = DSL.schema {
    queries(<span class="string"><span class="delimiter">'</span><span class="content">Queries</span><span class="delimiter">'</span></span>) {
      field(<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>) {
        type GraphQLString
        dataFetcher { DataFetchingEnvironment env -&gt;
          <span class="predefined-type">Context</span> context = env.context <span class="keyword">as</span> <span class="predefined-type">Context</span>

          <span class="keyword">return</span> context
            .header(<span class="string"><span class="delimiter">'</span><span class="content">Authorization</span><span class="delimiter">'</span></span>)       <i class="conum" data-value="1"></i><b>(1)</b>
            .map { <span class="string"><span class="delimiter">'</span><span class="content">GraphQL and Groovy</span><span class="delimiter">'</span></span> }  <i class="conum" data-value="2"></i><b>(2)</b>
            .orElse <span class="string"><span class="delimiter">'</span><span class="content">Unauthorizated</span><span class="delimiter">'</span></span>       <i class="conum" data-value="3"></i><b>(3)</b>
        }
      }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Takes content from header <code>Authorization</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If it had a value it returns a positive message</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Otherwise informs the user is not authorized</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Having the possibility of accessing Ratpack&#8217;s context could be useful
for things like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authentication</p>
</li>
<li>
<p>Authorization</p>
</li>
<li>
<p>Logging</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You could also be able to access the context through <code>instrumentation</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_graphql_errors">5.3. GraphQL errors</h3>
<div class="paragraph">
<p><code>gql-java</code> catches exceptions thrown while executing data fetchers and
shows their information along with the stack trace as output.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Error vs Exception</div>
<div class="paragraph">
<p>An exception should be considered something unexpected, different than
an error. An error could be a valid output.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The problem is that errors can&#8217;t be thrown and the only way to
propagate them when executing a data fetcher is via a data fetcher
instrumentation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">SecurityInstrumentation</span> <span class="directive">extends</span> NoOpInstrumentation {
  <span class="annotation">@Override</span>
  DataFetcher&lt;?&gt; instrumentDataFetcher(DataFetcher&lt;?&gt; dataFetcher, InstrumentationFieldFetchParameters parameters) {
    <span class="predefined-type">String</span> user = parameters.environment?.context?.user?.toString()

    <span class="keyword">if</span> (user) {
      <span class="keyword">return</span> dataFetcher
    }

    ExecutionPath path = parameters
      .getEnvironment()
      .getFieldTypeInfo()
      .getPath()

    GraphQLError error = DSL.error {
      message <span class="string"><span class="delimiter">'</span><span class="content">No user present</span><span class="delimiter">'</span></span>
      extensions(<span class="key">i18n</span>:<span class="string"><span class="delimiter">'</span><span class="content">error.not.present</span><span class="delimiter">'</span></span>)
    }

    parameters
      .getExecutionContext()
      .addError(error <span class="keyword">as</span> graphql.GraphQLError, path)

    <span class="keyword">return</span> { env -&gt; } <span class="keyword">as</span> DataFetcher
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can create a <code>GraphQLError</code> using <code>DSL.error</code>. But if what you
want to create is a fetcher adding an error to the current execution
context, this could be improved using <code>DSL.errorFetcher</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> gql.ratpack

<span class="keyword">import</span> <span class="include">ratpack.handling.Context</span>
<span class="keyword">import</span> <span class="include">graphql.schema.DataFetcher</span>
<span class="keyword">import</span> <span class="include">graphql.execution.instrumentation.NoOpInstrumentation</span>
<span class="keyword">import</span> <span class="include">graphql.execution.instrumentation.parameters.InstrumentationFieldFetchParameters</span>

<span class="keyword">import</span> <span class="include">gql.DSL</span>

<span class="type">class</span> <span class="class">SecurityChecker</span> <span class="directive">extends</span> NoOpInstrumentation {
  <span class="annotation">@Override</span>
  DataFetcher&lt;?&gt; instrumentDataFetcher(DataFetcher&lt;?&gt; dataFetcher, InstrumentationFieldFetchParameters parameters) {
    <span class="predefined-type">Context</span> context = parameters.environment.context <span class="keyword">as</span> <span class="predefined-type">Context</span>

    <span class="keyword">return</span> context
      .header(<span class="string"><span class="delimiter">'</span><span class="content">Authorization</span><span class="delimiter">'</span></span>)
      .map { dataFetcher }
      .orElse(DSL.errorFetcher(parameters) {
        message <span class="string"><span class="delimiter">'</span><span class="content">security</span><span class="delimiter">'</span></span>
        extensions(<span class="key">i18n</span>: <span class="string"><span class="delimiter">'</span><span class="content">error.security.authorization</span><span class="delimiter">'</span></span>)
      })
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the previous example if there&#8217;s no <code>Authorization</code> header then an
error will be shown in the response, otherwise the expected data
fetcher will take over the execution.</p>
</div>
</div>
<div class="sect2">
<h3 id="_instrumentation">5.4. Instrumentation</h3>
<div class="paragraph">
<p>Following <code>graphql-java</code> documentation The
graphql.execution.instrumentation.Instrumentation interface allows you
to inject code that can observe the execution of a query and also
change the runtime behaviour.</p>
</div>
<div class="paragraph">
<p>The <code>gql-ratpack</code> makes possible to add a given instance of type
<code>graphql.execution.instrumentation.Instrumentation</code> to the registry
and that instance will be used by the current execution.</p>
</div>
<div class="paragraph">
<p>If you&#8217;d like to use more than one instrumentation then you may create
an instance of
<code>graphql.execution.instrumentation.ChainedInstrumentation</code> and add all
other instrumentation instances to it, context will be passed through
the chained instrumentation to all children.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration">5.5. Configuration</h3>
<div class="paragraph">
<p>If you would like to disable the GraphiQL client, you can always configure the
GraphQLModule setting the <code>activateGraphiQL</code> to <code>false</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ratpack {
    bindings {
      module(GraphQLModule) { conf -&gt;
        conf.activateGraphiQL = <span class="predefined-constant">false</span> <i class="conum" data-value="1"></i><b>(1)</b>
      }
      <span class="comment">//...</span>
    }
    handlers {
     <span class="comment">//...</span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Setting the <code>activateGraphiQL</code> to false will disable GraphiQL client</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">GraphiQL Client limitation</div>
<div class="paragraph">
<p>At the moment, the GraphQL module provides GraphiQL as an static html
page. However the resources (scripts/css) required to make it work
properly aren&#8217;t loaded from Ratpack but retrieved online once it&#8217;s
loaded by the browser.</p>
</div>
<div class="paragraph">
<p>That means the GraphiQL client will only work if the browser accessing
it has online access.</p>
</div>
<div class="paragraph">
<p>Of course, the idea for upcoming releases would be to serve everything
from the module so that it could be used under any circumstances.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_development">6. Development</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_source_code">6.1. Source code</h3>
<div class="paragraph">
<p>Source code is available at <a href="https://github.com/grooviter/gql" class="bare">https://github.com/grooviter/gql</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_groovydoc">6.2. Groovydoc</h3>
<div class="paragraph">
<p>Groovy API is available at <a href="https://grooviter.github.io/gql/api/index.html" class="bare">https://grooviter.github.io/gql/api/index.html</a></p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.3.0<br>
Last updated 2018-01-28 18:48:44 +00:00
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.5.3/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>